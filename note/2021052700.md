# UDP解决丢包问题总结

### 收包率低/丢包率高的原因分析
- 缓存太小，不能及时接收数据。
连续多个UDP包超过了UDP接收缓冲区大小 ，比如：
    1. UDP包过大
    2. UDP发包速率过快，突发大数据流量超过了缓冲区上限
- recvfrom()接收到数据之后处理速度太慢
    如果数据接收和处理是连续进行的，那么可能由于数据处理过慢，两次recvfrom调用的时间间隔里发过来的包丢失

### 对应的解决方法
- UDP包过大
    解决方法：增加系统发送或接收缓冲区大小
    ```cpp
    int nBuf=32*1024;//设置为32K  
    setsockopt(s,SOL_SOCKET,SO_RCVBUF,(const char*)&nBuf,sizeof(int));
    setsockopt(s,SOL_SOCKET,SO_SNDBUF,(const char*)&nBuf,sizeof(int));
    ```
- 发包速率过快
    解决方法:增加应答机制，处理完一个包后，在继续发包
- recvfrom()接收到数据之后处理速度太慢
    服务器程序启动之出，开辟两个线程，一个线程专门用于接收数据包，并存放在应用层的缓存区；另外一个线程用于专门处理和响应数据包请求，避免因为处理数据造成数据丢包。其本质上还是增大了缓冲区大小，只是将系统缓冲区转移到了自己的缓冲区。
- 最复杂的方式
    在应用层实现丢包重发机制和超时机制，确保数据包不丢失。